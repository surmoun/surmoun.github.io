<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ã€Springç¯‡ã€‘æ¨¡æ‹Ÿç½‘ç«™ç™»å½•è·å–Token</title>
      <link href="/posts/2024/undefined.html"/>
      <url>/posts/2024/undefined.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€SpringBootç¯‡ã€‘ç™»å½•æ ¡éªŒæ‹¦æˆªå™¨è®¾ç½®</title>
      <link href="/posts/2024/639972599.html"/>
      <url>/posts/2024/639972599.html</url>
      
        <content type="html"><![CDATA[<h2 id="éœ€æ±‚åˆ†æ"><a href="#éœ€æ±‚åˆ†æ" class="headerlink" title="éœ€æ±‚åˆ†æ"></a>éœ€æ±‚åˆ†æ</h2><p>åå°ç®¡ç†ç³»ç»Ÿä¸­é™¤äº†ç™»å½•æ¥å£ã€è·å–éªŒè¯ç çš„æ¥å£åœ¨è®¿é—®çš„æ—¶å€™ä¸éœ€è¦éªŒè¯ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œå…¶ä½™çš„æ¥å£åœ¨è®¿é—®çš„æ—¶å€™éƒ½å¿…é¡»è¦æ±‚ç”¨æˆ·ç™»å½•æˆåŠŸä»¥åæ‰å¯ä»¥è¿›è¡Œè®¿é—®ã€‚</p><p>ç™»å½•è¿‡ç¨‹<br><img src="https://s21.ax1x.com/2024/07/16/pkIRPi9.png" alt="æ‹¦æˆªå™¨é…ç½®è¿‡ç¨‹"></p><p><img src="https://s21.ax1x.com/2024/07/16/pkI2xqU.png" alt="æ‹¦æˆªå™¨é…ç½®è¯´æ˜"></p><blockquote><p>å‰ç«¯è¯·æ±‚url ç»è¿‡æ‹¦æˆªå™¨ï¼ˆæ”¾è¡Œç™»å½•å’ŒéªŒè¯ç ï¼‰è¿›è¡Œåˆ¤æ–­è·å–åˆ°tokenï¼Œä»Redisä¸­æŸ¥è¯¢æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œ<br>è‹¥æ•°æ®å­˜åœ¨æ”¾åœ¨ThreadLocalçº¿ç¨‹å˜é‡ä¸­ï¼Œæ›´æ–°redis tokenå­˜å‚¨çš„æ—¶é—´å¹¶æ”¾è¡Œ<br>è‹¥ä¸å­˜åœ¨è¿”å›208çŠ¶æ€ç  è¿”å›å‰ç«¯é¡µé¢</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.spzx.common.util;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.spzx.model.entity.system.SysUser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthContextUtil</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªThreadLocalå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;SysUser&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;() ;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰å­˜å‚¨æ•°æ®çš„é™æ€æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(SysUser sysUser)</span> &#123;</span><br><span class="line">        threadLocal.set(sysUser);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰è·å–æ•°æ®çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SysUser <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get() ;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ é™¤æ•°æ®çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">        threadLocal.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ‹¦æˆªå™¨Hander"><a href="#æ‹¦æˆªå™¨Hander" class="headerlink" title="æ‹¦æˆªå™¨Hander"></a>æ‹¦æˆªå™¨Hander</h2><blockquote><p>UserAuthProperties ç”¨äºè¯»å–ymlä¸­çš„å‚æ•°</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spzx.auth&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAuthProperties</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt;  noAuthUrls;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginAuthInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RedisTemplate&lt;String , String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–é¢„æ£€è¯·æ±‚æ”¾è¡Œ</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;OPTIONS&quot;</span>.equals(method))&#123;</span><br><span class="line">            <span class="keyword">return</span>  <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å–å¾—token</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isEmpty(token))</span><br><span class="line">        &#123;</span><br><span class="line">            responseNoLoginInfo(response) ;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å¾—åˆ°ç”¨æˆ·json</span></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">userInfoJSON</span> <span class="operator">=</span> redisTemplate.opsForValue().get(CacheConstant.User_Login_Prefix + token);</span><br><span class="line">        <span class="keyword">if</span>(StrUtil.isEmpty(userInfoJSON))</span><br><span class="line">        &#123;</span><br><span class="line">            responseNoLoginInfo(response) ;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//jsonå­˜åˆ°threadLocal</span></span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">sysUser</span> <span class="operator">=</span> JSON.parseObject(userInfoJSON, SysUser.class);</span><br><span class="line">        AuthContextUtil.set(sysUser);</span><br><span class="line">        <span class="comment">//é‡ç½®redis</span></span><br><span class="line"></span><br><span class="line">        redisTemplate.expire(CacheConstant.User_Login_Prefix + token,<span class="number">30</span>, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">responseNoLoginInfo</span><span class="params">(HttpServletResponse response)</span> &#123;</span><br><span class="line">        Result&lt;Object&gt; result = Result.build(<span class="literal">null</span>, ResultCodeEnum.LOGIN_AUTH);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        response.setCharacterEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;text/html; charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            writer = response.getWriter();</span><br><span class="line">            writer.print(JSON.toJSONString(result));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (writer != <span class="literal">null</span>) writer.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        AuthContextUtil.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é…ç½®æ‹¦æˆªå™¨"><a href="#é…ç½®æ‹¦æˆªå™¨" class="headerlink" title="é…ç½®æ‹¦æˆªå™¨"></a>é…ç½®æ‹¦æˆªå™¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfiguration</span>  <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    LoginAuthInterceptor loginAuthInterceptor;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserAuthProperties userAuthProperties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*ç™»å½•æ ¡éªŒ</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        registry.addInterceptor(loginAuthInterceptor)</span><br><span class="line">                .excludePathPatterns(userAuthProperties.getNoAuthUrls())</span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*CROSè·¨åŸŸ</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> &#123;</span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)      <span class="comment">// æ·»åŠ è·¯å¾„è§„åˆ™</span></span><br><span class="line">                .allowCredentials(<span class="literal">true</span>)               <span class="comment">// æ˜¯å¦å…è®¸åœ¨è·¨åŸŸçš„æƒ…å†µä¸‹ä¼ é€’Cookie</span></span><br><span class="line">                .allowedOriginPatterns(<span class="string">&quot;*&quot;</span>)           <span class="comment">// å…è®¸è¯·æ±‚æ¥æºçš„åŸŸè§„åˆ™</span></span><br><span class="line">                .allowedMethods(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>) ;                <span class="comment">// å…è®¸æ‰€æœ‰çš„è¯·æ±‚å¤´</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€SpringBootç¯‡ã€‘è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†</title>
      <link href="/posts/2024/2677420933.html"/>
      <url>/posts/2024/2677420933.html</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸˆå¼‚å¸¸å¤„ç†"><a href="#ğŸˆå¼‚å¸¸å¤„ç†" class="headerlink" title="ğŸˆå¼‚å¸¸å¤„ç†"></a>ğŸˆå¼‚å¸¸å¤„ç†</h2><p>åœ¨ Java ä¸­ï¼Œè‡ªå®šä¹‰å¼‚å¸¸æ˜¯æŒ‡ç”¨æˆ·æ ¹æ®è‡ªå·±çš„éœ€æ±‚åˆ›å»ºçš„å¼‚å¸¸ç±»ã€‚Java æä¾›äº†ä¸€äº›é¢„å®šä¹‰çš„å¼‚å¸¸ç±»ï¼Œå¦‚ <strong>NullPointerException</strong>ã€<strong>ArrayIndexOutOfBoundsException</strong>ç­‰ï¼Œä½†æœ‰æ—¶è¿™äº›é¢„å®šä¹‰çš„å¼‚å¸¸ç±»å¹¶ä¸èƒ½å®Œå…¨æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»æ¥è¡¨ç¤ºç‰¹å®šçš„å¼‚å¸¸æƒ…å†µã€‚</p><p>è‡ªå®šä¹‰å¼‚å¸¸ç±»é€šå¸¸ç»§æ‰¿è‡ª Exception ç±»æˆ– RuntimeException ç±»ï¼Œä»¥åŠå®ƒä»¬çš„å­ç±»ï¼Œå¹¶æ ¹æ®éœ€è¦æ·»åŠ ç›¸åº”çš„æ„é€ æ–¹æ³•å’Œå…¶ä»–æ–¹æ³•ä»¥æ»¡è¶³ç‰¹å®šçš„å¼‚å¸¸å¤„ç†éœ€æ±‚ï¼Œè‡ªå®šä¹‰å¼‚å¸¸ç±»å¯ä»¥åŒ…å«é¢å¤–çš„å±æ€§å’Œæ–¹æ³•ï¼Œä»¥æä¾›æ›´å¤šçš„ä¿¡æ¯å’ŒåŠŸèƒ½ã€‚</p><p>ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»æ—¶ï¼Œé€šå¸¸çš„åšæ³•æ˜¯åœ¨æ–¹æ³•ä¸­ä½¿ç”¨ throw è¯­å¥æ¥æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸ï¼Œç„¶ååœ¨è°ƒç”¨è¯¥æ–¹æ³•çš„åœ°æ–¹ä½¿ç”¨ try-catch è¯­å¥å—æ¥æ•è·å¹¶å¤„ç†å¼‚å¸¸ã€‚</p><p><img src="https://s21.ax1x.com/2024/07/16/pkI2JUJ.png" alt="å¼‚å¸¸ç±»"></p><blockquote><p>æˆ‘ä»¬æƒ³è®©å¼‚å¸¸ç»“æœä¹Ÿæ˜¾ç¤ºä¸ºç»Ÿä¸€çš„è¿”å›ç»“æœå¯¹è±¡ï¼Œå¹¶ä¸”ç»Ÿä¸€å¤„ç†ç³»ç»Ÿçš„å¼‚å¸¸ä¿¡æ¯ï¼Œé‚£ä¹ˆï¼Œéœ€è¦ç»Ÿä¸€å¼‚å¸¸å¤„ç†</p></blockquote><h2 id="ğŸ†ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨"><a href="#ğŸ†ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨" class="headerlink" title="ğŸ†ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨"></a>ğŸ†ç»Ÿä¸€å¼‚å¸¸å¤„ç†å™¨</h2><blockquote><p>@ExceptionHandler(Exception.class)<br>@ControllerAdvice</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHander</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">error</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line"><span class="keyword">return</span>  Result.build(<span class="literal">null</span>,<span class="number">201</span>,<span class="string">&quot;å‡ºç°äº†å¼‚å¸¸&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * ç‰¹å®šçš„å¼‚å¸¸å¤„ç†</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">   <span class="meta">@ExceptionHandler(ArithmeticException.class)</span></span><br><span class="line">   <span class="meta">@ResponseBody</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">error</span><span class="params">(ArithmeticException e)</span>&#123;</span><br><span class="line">       e.printStackTrace();</span><br><span class="line">       <span class="keyword">return</span>  Result.build(<span class="literal">null</span>,<span class="number">202</span>,<span class="string">&quot;ç‰¹å®šçš„å¼‚å¸¸&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ğŸ€è‡ªå®šä¹‰å¼‚å¸¸"><a href="#ğŸ€è‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="ğŸ€è‡ªå®šä¹‰å¼‚å¸¸"></a>ğŸ€è‡ªå®šä¹‰å¼‚å¸¸</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GuiguException</span>  <span class="keyword">extends</span>  <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer CODE;</span><br><span class="line">    <span class="keyword">private</span> String  message;</span><br><span class="line">    <span class="keyword">private</span> ResultCodeEnum resultCodeEnum;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GuiguException</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GuiguException</span><span class="params">(Integer CODE, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.CODE = CODE;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GuiguException</span><span class="params">(ResultCodeEnum resultCodeEnum)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.CODE = resultCodeEnum.getCode();</span><br><span class="line">        <span class="built_in">this</span>.message = resultCodeEnum.getMessage();</span><br><span class="line">        <span class="built_in">this</span>.resultCodeEnum = resultCodeEnum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰å¼‚å¸¸</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ExceptionHandler(GuiguException.class)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">error</span><span class="params">(GuiguException e)</span></span><br><span class="line">&#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">    <span class="keyword">return</span> Result.build(<span class="literal">null</span>,e.getCODE(),e.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€SpringBootç¯‡ã€‘é˜¿é‡Œäº‘OSS--æ–‡ä»¶å­˜å‚¨</title>
      <link href="/posts/2024/2973527109.html"/>
      <url>/posts/2024/2973527109.html</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸŒ¹ä»€ä¹ˆæ˜¯é˜¿é‡Œäº‘OSS"><a href="#ğŸŒ¹ä»€ä¹ˆæ˜¯é˜¿é‡Œäº‘OSS" class="headerlink" title="ğŸŒ¹ä»€ä¹ˆæ˜¯é˜¿é‡Œäº‘OSS"></a>ğŸŒ¹ä»€ä¹ˆæ˜¯é˜¿é‡Œäº‘OSS</h2><p>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼ˆAlibaba Cloud Object Storage Serviceï¼Œç®€ç§°OSSï¼‰æ˜¯é˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ç®€å•çš„APIæ¥å£åœ¨ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹ä¸Šä¼ å’Œä¸‹è½½æ•°æ®ï¼Œé€‚ç”¨äºå›¾åƒã€éŸ³è§†é¢‘ã€æ–‡æ¡£ã€ç½‘ç«™ç­‰å„ç§ç±»å‹çš„æ•°æ®å­˜å‚¨å’Œåˆ†å‘åœºæ™¯ã€‚</p><h2 id="â­é˜¿é‡Œäº‘OSSçš„ä¼˜ç‚¹"><a href="#â­é˜¿é‡Œäº‘OSSçš„ä¼˜ç‚¹" class="headerlink" title="â­é˜¿é‡Œäº‘OSSçš„ä¼˜ç‚¹"></a>â­é˜¿é‡Œäº‘OSSçš„ä¼˜ç‚¹</h2><p><strong>é«˜å¯é æ€§</strong>ï¼šOSSé‡‡ç”¨äº†å¤šå‰¯æœ¬å­˜å‚¨å’Œå®¹ç¾å¤‡ä»½æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®çš„é«˜å¯é æ€§å’ŒæŒä¹…æ€§ã€‚<br><strong>å®‰å…¨æ€§</strong>ï¼šæ”¯æŒå¤šç§å®‰å…¨ç­–ç•¥ï¼Œå¦‚è®¿é—®æ§åˆ¶ã€åŠ å¯†ä¼ è¾“ç­‰ï¼Œä¿éšœæ•°æ®çš„å®‰å…¨æ€§ã€‚<br><strong>å¼¹æ€§æ‰©å±•</strong>ï¼šæ”¯æŒæŒ‰éœ€å­˜å‚¨å’Œå¼¹æ€§æ‰©å±•ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚çµæ´»è°ƒæ•´å­˜å‚¨å®¹é‡ã€‚<br><strong>ä½æˆæœ¬</strong>ï¼šOSSçš„å­˜å‚¨è´¹ç”¨ä½å»‰ï¼Œä¸”æ”¯æŒæŒ‰é‡ä»˜è´¹æ¨¡å¼ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ ¹æ®å®é™…ä½¿ç”¨é‡ä»˜è´¹</p><h2 id="ğŸ³ï¸â€ğŸŒˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨äº‘æœåŠ¡OSS"><a href="#ğŸ³ï¸â€ğŸŒˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨äº‘æœåŠ¡OSS" class="headerlink" title="ğŸ³ï¸â€ğŸŒˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨äº‘æœåŠ¡OSS"></a>ğŸ³ï¸â€ğŸŒˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨äº‘æœåŠ¡OSS</h2><p>è§£å†³æœ¬åœ°å­˜å‚¨æ— æ³•ç›´æ¥è®¿é—®ï¼Œæœ¬åœ°ç£ç›˜ç©ºé—´æœ‰é™ï¼Œæœ¬åœ°ç£ç›˜æŸåè¿™3ä¸ªé—®é¢˜</p><h2 id="ğŸ„ä½¿ç”¨æ­¥éª¤"><a href="#ğŸ„ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ğŸ„ä½¿ç”¨æ­¥éª¤"></a>ğŸ„ä½¿ç”¨æ­¥éª¤</h2><p><img src="https://img2024.cnblogs.com/blog/1931734/202406/1931734-20240604073206273-1833203380.png" alt="image"></p><h2 id="æ–‡ä»¶ä¸Šä¼ æ“ä½œ"><a href="#æ–‡ä»¶ä¸Šä¼ æ“ä½œ" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ“ä½œ"></a>æ–‡ä»¶ä¸Šä¼ æ“ä½œ</h2><hr><blockquote><p>ğŸˆåœ¨pomæ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢çš„ä»£ç </p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;aliyun.sdk.oss&gt;3.10.2&lt;/aliyun.sdk.oss&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;com.aliyun.oss&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;aliyun-sdk-oss&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;$&#123;aliyun.sdk.oss&#125;&lt;/version&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>ğŸˆæœ¬åœ°å­˜å‚¨çš„è¯ åœ¨ymlä¸­å†™æ˜å­˜å‚¨åœ°æ–¹</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ali:</span><br><span class="line">  spring:</span><br><span class="line">    localhost: D:\Program Files\Project\Test-Project\TEST01\alioosdemo\ali-service\src\main\resources\upload</span><br></pre></td></tr></table></figure><blockquote><p>ğŸˆåœ¨Controllerå±‚è¿›è¡Œä¸Šä¼ æ“ä½œ</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/api/common&quot;)</span><br><span class="line"></span><br><span class="line">public class CommonController &#123;</span><br><span class="line">    @Value(&quot;$&#123;ali.spring.localhost&#125;&quot;)</span><br><span class="line">    private  String path;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private AliOssUtil aliOssUtil;</span><br><span class="line">    /**</span><br><span class="line">     * æ–‡ä»¶ä¸Šä¼ </span><br><span class="line">     */</span><br><span class="line">    @PostMapping(&quot;upload&quot;)</span><br><span class="line">    public String Upload(MultipartFile file) throws IOException &#123;</span><br><span class="line"></span><br><span class="line">        //è·å–åŸå§‹å</span><br><span class="line">        String originalFilename = file.getOriginalFilename();</span><br><span class="line">        //æˆªå– .png</span><br><span class="line">        String substring = originalFilename.substring(originalFilename.lastIndexOf(&quot;.&quot;));</span><br><span class="line">        //æ„é€ ä¸€ä¸ªæ–°åç§°  ä½¿ç”¨Hutoolå·¥å…·ç±»</span><br><span class="line">        String filename = IdUtil.simpleUUID() + substring;</span><br><span class="line">//æ–°å»ºFileå¯¹è±¡ è¿›è¡Œå­˜å‚¨</span><br><span class="line">        File file1 = new File(filename);</span><br><span class="line">     try &#123;</span><br><span class="line">            file.transferTo(file1);</span><br><span class="line">         &#125; catch (IOException e) &#123;</span><br><span class="line">            throw new RuntimeException(e);</span><br><span class="line">         &#125;</span><br><span class="line">         return  &quot;ä¸Šä¼ æˆåŠŸ&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ æ“ä½œï¼ˆOSSç‰ˆï¼‰"><a href="#æ–‡ä»¶ä¸Šä¼ æ“ä½œï¼ˆOSSç‰ˆï¼‰" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ“ä½œï¼ˆOSSç‰ˆï¼‰"></a>æ–‡ä»¶ä¸Šä¼ æ“ä½œï¼ˆOSSç‰ˆï¼‰</h2><blockquote><p>ğŸˆOsså­˜å‚¨ åœ¨ymlä¸­å†™æ˜å­˜å‚¨åœ°æ–¹ <strong>access-key-id</strong>ã€ <strong>access-key-secret</strong>ã€<strong>bucket-name</strong></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ali:</span><br><span class="line">  alioos:</span><br><span class="line">    endpoint: oss-cn-beijing.aliyuncs.com</span><br><span class="line">    access-key-id: ***********</span><br><span class="line">    access-key-secret: ***********</span><br><span class="line">    bucket-name: ***********</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨@ConfigurationPropertiesæ³¨è§£è¯»å– propertiesçš„æ•°æ®</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*</span><br><span class="line">*@Component è¡¨ç¤ºå°†è¯¥ç±»æ ‡è¯†ä¸ºBean</span><br><span class="line">*@ConfigurationProperties(prefix = &quot;ali.alioos&quot;)ç”¨äºç»‘å®šå±æ€§ï¼Œå…¶ä¸­prefixè¡¨ç¤ºæ‰€ç»‘å®šçš„å±æ€§çš„å‰ç¼€ã€‚</span><br><span class="line">**/</span><br><span class="line">@Component</span><br><span class="line">@ConfigurationProperties(prefix = &quot;ali.alioos&quot;)</span><br><span class="line">@Data</span><br><span class="line">public class AliOssProprtyies &#123;</span><br><span class="line">    private String endpoint;</span><br><span class="line">    private String accessKeyId;</span><br><span class="line">    private String accessKeySecret;</span><br><span class="line">    private String bucketName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®ç±»ï¼Œç”¨äºåˆ›å»ºAliOssUtilå¯¹è±¡</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class OssConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    @ConditionalOnMissingBean</span><br><span class="line">    public AliOssUtil aliOssUtil(AliOssProprtyies aliOssProprtyies)&#123;</span><br><span class="line">        return  new AliOssUtil(aliOssProprtyies.getEndpoint(),</span><br><span class="line">                    aliOssProprtyies.getAccessKeyId(),</span><br><span class="line">                    aliOssProprtyies.getAccessKeySecret(),</span><br><span class="line">                aliOssProprtyies.getBucketName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>å®šä¹‰é˜¿é‡Œäº‘å·¥å…·ç±»</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span class="line">@Slf4j</span><br><span class="line">public class AliOssUtil &#123;</span><br><span class="line"></span><br><span class="line">    private String endpoint;</span><br><span class="line">    private String accessKeyId;</span><br><span class="line">    private String accessKeySecret;</span><br><span class="line">    private String bucketName;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æ–‡ä»¶ä¸Šä¼ </span><br><span class="line">     *</span><br><span class="line">     * @param bytes</span><br><span class="line">     * @param objectName</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public String upload(byte[] bytes, String objectName) &#123;</span><br><span class="line"></span><br><span class="line">        // åˆ›å»ºOSSClientå®ä¾‹ã€‚</span><br><span class="line">        OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            // åˆ›å»ºPutObjectè¯·æ±‚ã€‚</span><br><span class="line">            ossClient.putObject(bucketName, objectName, new ByteArrayInputStream(bytes));</span><br><span class="line">        &#125; catch (OSSException oe) &#123;</span><br><span class="line">            System.out.println(&quot;Caught an OSSException, which means your request made it to OSS, &quot;</span><br><span class="line">                    + &quot;but was rejected with an error response for some reason.&quot;);</span><br><span class="line">            System.out.println(&quot;Error Message:&quot; + oe.getErrorMessage());</span><br><span class="line">            System.out.println(&quot;Error Code:&quot; + oe.getErrorCode());</span><br><span class="line">            System.out.println(&quot;Request ID:&quot; + oe.getRequestId());</span><br><span class="line">            System.out.println(&quot;Host ID:&quot; + oe.getHostId());</span><br><span class="line">        &#125; catch (ClientException ce) &#123;</span><br><span class="line">            System.out.println(&quot;Caught an ClientException, which means the client encountered &quot;</span><br><span class="line">                    + &quot;a serious internal problem while trying to communicate with OSS, &quot;</span><br><span class="line">                    + &quot;such as not being able to access the network.&quot;);</span><br><span class="line">            System.out.println(&quot;Error Message:&quot; + ce.getMessage());</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (ossClient != null) &#123;</span><br><span class="line">                ossClient.shutdown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //æ–‡ä»¶è®¿é—®è·¯å¾„è§„åˆ™ https://BucketName.Endpoint/ObjectName</span><br><span class="line">        StringBuilder stringBuilder = new StringBuilder(&quot;https://&quot;);</span><br><span class="line">        stringBuilder</span><br><span class="line">                .append(bucketName)</span><br><span class="line">                .append(&quot;.&quot;)</span><br><span class="line">                .append(endpoint)</span><br><span class="line">                .append(&quot;/&quot;)</span><br><span class="line">                .append(objectName);</span><br><span class="line"></span><br><span class="line">        log.info(&quot;æ–‡ä»¶ä¸Šä¼ åˆ°:&#123;&#125;&quot;, stringBuilder.toString());</span><br><span class="line"></span><br><span class="line">        return stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è‡ªå®šä¹‰ä¸Šä¼ æ¥å£</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Autowired</span><br><span class="line">private AliOssUtil aliOssUtil;</span><br><span class="line">/**</span><br><span class="line"> * æ–‡ä»¶ä¸Šä¼ </span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">@PostMapping(&quot;upload&quot;)</span><br><span class="line">public String Upload(MultipartFile file) throws IOException &#123;</span><br><span class="line"></span><br><span class="line">    //è·å–åŸå§‹å</span><br><span class="line">    String originalFilename = file.getOriginalFilename();</span><br><span class="line">    //æˆªå– .png</span><br><span class="line">    String substring = originalFilename.substring(originalFilename.lastIndexOf(&quot;.&quot;));</span><br><span class="line">    //æ„é€ ä¸€ä¸ªæ–°åç§°</span><br><span class="line">    String filename = IdUtil.simpleUUID() + substring;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    aliOssUtil.upload(file.getBytes(), filename);</span><br><span class="line"></span><br><span class="line">    return  &quot;ä¸Šä¼ æˆåŠŸ&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://s21.ax1x.com/2024/07/16/pkIhzlR.png" alt="image-20240716233536204"></p><p><img src="https://s21.ax1x.com/2024/07/16/pkI4pOx.png" alt="é˜¿é‡Œäº‘bannerå›¾"></p><p><img src="https://s21.ax1x.com/2024/07/17/pkI4XHf.png" alt="img"></p><p><img src="https://s21.ax1x.com/2024/07/17/pkI5pCQ.png" alt="SrpingBoot"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ã€SpringBootç¯‡ã€‘é˜¿é‡Œäº‘OSS--æ–‡ä»¶å­˜å‚¨</title>
      <link href="/posts/2024/2973527110.html"/>
      <url>/posts/2024/2973527110.html</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸŒ¹ä»€ä¹ˆæ˜¯é˜¿é‡Œäº‘OSS"><a href="#ğŸŒ¹ä»€ä¹ˆæ˜¯é˜¿é‡Œäº‘OSS" class="headerlink" title="ğŸŒ¹ä»€ä¹ˆæ˜¯é˜¿é‡Œäº‘OSS"></a>ğŸŒ¹ä»€ä¹ˆæ˜¯é˜¿é‡Œäº‘OSS</h2><p>é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨ï¼ˆAlibaba Cloud Object Storage Serviceï¼Œç®€ç§°OSSï¼‰æ˜¯é˜¿é‡Œäº‘æä¾›çš„æµ·é‡ã€å®‰å…¨ã€ä½æˆæœ¬ã€é«˜å¯é çš„äº‘å­˜å‚¨æœåŠ¡ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ç®€å•çš„APIæ¥å£åœ¨ä»»ä½•æ—¶é—´ã€ä»»ä½•åœ°ç‚¹ä¸Šä¼ å’Œä¸‹è½½æ•°æ®ï¼Œé€‚ç”¨äºå›¾åƒã€éŸ³è§†é¢‘ã€æ–‡æ¡£ã€ç½‘ç«™ç­‰å„ç§ç±»å‹çš„æ•°æ®å­˜å‚¨å’Œåˆ†å‘åœºæ™¯ã€‚</p><h2 id="â­é˜¿é‡Œäº‘OSSçš„ä¼˜ç‚¹"><a href="#â­é˜¿é‡Œäº‘OSSçš„ä¼˜ç‚¹" class="headerlink" title="â­é˜¿é‡Œäº‘OSSçš„ä¼˜ç‚¹"></a>â­é˜¿é‡Œäº‘OSSçš„ä¼˜ç‚¹</h2><p><strong>é«˜å¯é æ€§</strong>ï¼šOSSé‡‡ç”¨äº†å¤šå‰¯æœ¬å­˜å‚¨å’Œå®¹ç¾å¤‡ä»½æœºåˆ¶ï¼Œç¡®ä¿æ•°æ®çš„é«˜å¯é æ€§å’ŒæŒä¹…æ€§ã€‚<br><strong>å®‰å…¨æ€§</strong>ï¼šæ”¯æŒå¤šç§å®‰å…¨ç­–ç•¥ï¼Œå¦‚è®¿é—®æ§åˆ¶ã€åŠ å¯†ä¼ è¾“ç­‰ï¼Œä¿éšœæ•°æ®çš„å®‰å…¨æ€§ã€‚<br><strong>å¼¹æ€§æ‰©å±•</strong>ï¼šæ”¯æŒæŒ‰éœ€å­˜å‚¨å’Œå¼¹æ€§æ‰©å±•ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚çµæ´»è°ƒæ•´å­˜å‚¨å®¹é‡ã€‚<br><strong>ä½æˆæœ¬</strong>ï¼šOSSçš„å­˜å‚¨è´¹ç”¨ä½å»‰ï¼Œä¸”æ”¯æŒæŒ‰é‡ä»˜è´¹æ¨¡å¼ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ ¹æ®å®é™…ä½¿ç”¨é‡ä»˜è´¹</p><h2 id="ğŸ³ï¸â€ğŸŒˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨äº‘æœåŠ¡OSS"><a href="#ğŸ³ï¸â€ğŸŒˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨äº‘æœåŠ¡OSS" class="headerlink" title="ğŸ³ï¸â€ğŸŒˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨äº‘æœåŠ¡OSS"></a>ğŸ³ï¸â€ğŸŒˆä¸ºä»€ä¹ˆè¦ä½¿ç”¨äº‘æœåŠ¡OSS</h2><p>è§£å†³æœ¬åœ°å­˜å‚¨æ— æ³•ç›´æ¥è®¿é—®ï¼Œæœ¬åœ°ç£ç›˜ç©ºé—´æœ‰é™ï¼Œæœ¬åœ°ç£ç›˜æŸåè¿™3ä¸ªé—®é¢˜</p><h2 id="ğŸ„ä½¿ç”¨æ­¥éª¤"><a href="#ğŸ„ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ğŸ„ä½¿ç”¨æ­¥éª¤"></a>ğŸ„ä½¿ç”¨æ­¥éª¤</h2><p><img src="https://s21.ax1x.com/2024/07/16/pkI2Fu8.png" alt="image-20240716215007220"></p><h2 id="æ–‡ä»¶ä¸Šä¼ æ“ä½œ"><a href="#æ–‡ä»¶ä¸Šä¼ æ“ä½œ" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ“ä½œ"></a>æ–‡ä»¶ä¸Šä¼ æ“ä½œ</h2><hr><blockquote><p>ğŸˆåœ¨pomæ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢çš„ä»£ç </p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aliyun.sdk.oss</span>&gt;</span>3.10.2<span class="tag">&lt;/<span class="name">aliyun.sdk.oss</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aliyun.sdk.oss&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>ğŸˆæœ¬åœ°å­˜å‚¨çš„è¯ åœ¨ymlä¸­å†™æ˜å­˜å‚¨åœ°æ–¹</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ali:</span></span><br><span class="line">  <span class="attr">spring:</span></span><br><span class="line">    <span class="attr">localhost:</span> <span class="string">D:\Program</span> <span class="string">Files\Project\Test-Project\TEST01\alioosdemo\ali-service\src\main\resources\upload</span></span><br></pre></td></tr></table></figure><blockquote><p>ğŸˆåœ¨Controllerå±‚è¿›è¡Œä¸Šä¼ æ“ä½œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/common&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;ali.spring.localhost&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span>  String path;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AliOssUtil aliOssUtil;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">Upload</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//è·å–åŸå§‹å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">        <span class="comment">//æˆªå– .png</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">substring</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        <span class="comment">//æ„é€ ä¸€ä¸ªæ–°åç§°  ä½¿ç”¨Hutoolå·¥å…·ç±»</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> IdUtil.simpleUUID() + substring;</span><br><span class="line"><span class="comment">//æ–°å»ºFileå¯¹è±¡ è¿›è¡Œå­˜å‚¨</span></span><br><span class="line">        <span class="type">File</span> <span class="variable">file1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(filename);</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">            file.transferTo(file1);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">return</span>  <span class="string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ–‡ä»¶ä¸Šä¼ æ“ä½œï¼ˆOSSç‰ˆï¼‰"><a href="#æ–‡ä»¶ä¸Šä¼ æ“ä½œï¼ˆOSSç‰ˆï¼‰" class="headerlink" title="æ–‡ä»¶ä¸Šä¼ æ“ä½œï¼ˆOSSç‰ˆï¼‰"></a>æ–‡ä»¶ä¸Šä¼ æ“ä½œï¼ˆOSSç‰ˆï¼‰</h2><blockquote><p>ğŸˆOsså­˜å‚¨ åœ¨ymlä¸­å†™æ˜å­˜å‚¨åœ°æ–¹ <strong>access-key-id</strong>ã€ <strong>access-key-secret</strong>ã€<strong>bucket-name</strong></p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ali:</span></span><br><span class="line">  <span class="attr">alioos:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">oss-cn-beijing.aliyuncs.com</span></span><br><span class="line">    <span class="attr">access-key-id:</span> <span class="string">***********</span></span><br><span class="line">    <span class="attr">access-key-secret:</span> <span class="string">***********</span></span><br><span class="line">    <span class="attr">bucket-name:</span> <span class="string">***********</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨@ConfigurationPropertiesæ³¨è§£è¯»å– propertiesçš„æ•°æ®</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*<span class="doctag">@Component</span> è¡¨ç¤ºå°†è¯¥ç±»æ ‡è¯†ä¸ºBean</span></span><br><span class="line"><span class="comment">*<span class="doctag">@ConfigurationProperties</span>(prefix = &quot;ali.alioos&quot;)ç”¨äºç»‘å®šå±æ€§ï¼Œå…¶ä¸­prefixè¡¨ç¤ºæ‰€ç»‘å®šçš„å±æ€§çš„å‰ç¼€ã€‚</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;ali.alioos&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOssProprtyies</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®ç±»ï¼Œç”¨äºåˆ›å»ºAliOssUtilå¯¹è±¡</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> AliOssUtil <span class="title function_">aliOssUtil</span><span class="params">(AliOssProprtyies aliOssProprtyies)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> <span class="title class_">AliOssUtil</span>(aliOssProprtyies.getEndpoint(),</span><br><span class="line">                    aliOssProprtyies.getAccessKeyId(),</span><br><span class="line">                    aliOssProprtyies.getAccessKeySecret(),</span><br><span class="line">                aliOssProprtyies.getBucketName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>å®šä¹‰é˜¿é‡Œäº‘å·¥å…·ç±»</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOssUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> objectName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="type">byte</span>[] bytes, String objectName)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºOSSClientå®ä¾‹ã€‚</span></span><br><span class="line">        <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºPutObjectè¯·æ±‚ã€‚</span></span><br><span class="line">            ossClient.putObject(bucketName, objectName, <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bytes));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (OSSException oe) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught an OSSException, which means your request made it to OSS, &quot;</span></span><br><span class="line">                    + <span class="string">&quot;but was rejected with an error response for some reason.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Message:&quot;</span> + oe.getErrorMessage());</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Code:&quot;</span> + oe.getErrorCode());</span><br><span class="line">            System.out.println(<span class="string">&quot;Request ID:&quot;</span> + oe.getRequestId());</span><br><span class="line">            System.out.println(<span class="string">&quot;Host ID:&quot;</span> + oe.getHostId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClientException ce) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Caught an ClientException, which means the client encountered &quot;</span></span><br><span class="line">                    + <span class="string">&quot;a serious internal problem while trying to communicate with OSS, &quot;</span></span><br><span class="line">                    + <span class="string">&quot;such as not being able to access the network.&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;Error Message:&quot;</span> + ce.getMessage());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ossClient != <span class="literal">null</span>) &#123;</span><br><span class="line">                ossClient.shutdown();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æ–‡ä»¶è®¿é—®è·¯å¾„è§„åˆ™ https://BucketName.Endpoint/ObjectName</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;https://&quot;</span>);</span><br><span class="line">        stringBuilder</span><br><span class="line">                .append(bucketName)</span><br><span class="line">                .append(<span class="string">&quot;.&quot;</span>)</span><br><span class="line">                .append(endpoint)</span><br><span class="line">                .append(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">                .append(objectName);</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;æ–‡ä»¶ä¸Šä¼ åˆ°:&#123;&#125;&quot;</span>, stringBuilder.toString());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è‡ªå®šä¹‰ä¸Šä¼ æ¥å£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AliOssUtil aliOssUtil;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ–‡ä»¶ä¸Šä¼ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">Upload</span><span class="params">(MultipartFile file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–åŸå§‹å</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">    <span class="comment">//æˆªå– .png</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">substring</span> <span class="operator">=</span> originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">//æ„é€ ä¸€ä¸ªæ–°åç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> IdUtil.simpleUUID() + substring;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    aliOssUtil.upload(file.getBytes(), filename);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>  <span class="string">&quot;ä¸Šä¼ æˆåŠŸ&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
